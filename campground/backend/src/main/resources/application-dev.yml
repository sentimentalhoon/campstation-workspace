# ================================
# CampStation Backend - Development Environment Configuration (Spring Boot 3.x)
# ================================
# 개발 환경 최적화 설정
# - PostgreSQL DB 사용
# - Flyway 스키마 관리
# - 개발 편의 지원
# - Debug 모드 활성화

spring:
  # ================================
  # Threads Configuration (Development)
  # ================================
  threads:
    virtual:
      enabled: true

  # ================================
  # Database Configuration (PostgreSQL for Development)
  # ================================
  datasource:
    url: ${DB_URL:jdbc:postgresql://db:5432/campstation}
    driver-class-name: ${DB_DRIVER:org.postgresql.Driver}
    username: ${DB_USERNAME:campstation}
    password: ${DB_PASSWORD:campstation2024}
    hikari:
      pool-name: CampStationDevHikariPool
      maximum-pool-size: ${DB_POOL_SIZE:20}
      minimum-idle: ${DB_POOL_MIN_IDLE:5}
      connection-timeout: ${DB_CONNECTION_TIMEOUT:30000}
      idle-timeout: ${DB_IDLE_TIMEOUT:600000}
      max-lifetime: ${DB_MAX_LIFETIME:1800000}
      leak-detection-threshold: ${DB_LEAK_DETECTION_THRESHOLD:60000}
      validation-timeout: ${DB_VALIDATION_TIMEOUT:5000}
      connection-test-query: SELECT 1
      data-source-properties:
        cachePrepStmts: true
        prepStmtCacheSize: 250
        prepStmtCacheSqlLimit: 2048
        useServerPrepStmts: true

  # ================================
  # Redis Configuration (Development - Spring Boot 3.x)
  # ================================
  redis:
    host: ${REDIS_HOST:redis}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD:}
    timeout: ${REDIS_TIMEOUT:5000ms}
    database: ${REDIS_DATABASE:0}
    connect-timeout: ${REDIS_CONNECT_TIMEOUT:2000ms}
    lettuce:
      pool:
        max-active: ${REDIS_POOL_MAX_ACTIVE:8}
        max-idle: ${REDIS_POOL_MAX_IDLE:8}
        min-idle: ${REDIS_POOL_MIN_IDLE:0}
        max-wait: ${REDIS_POOL_MAX_WAIT:-1ms}
        time-between-eviction-runs: ${REDIS_POOL_TIME_BETWEEN_EVICTION:10s}
      shutdown-timeout: ${REDIS_SHUTDOWN_TIMEOUT:100ms}
      client-name: ${REDIS_CLIENT_NAME:campstation-dev}

  # ================================
  # JPA/Hibernate Configuration (Development)
  # LazyInitializationException 방지 및 디버깅 최적화
  # ================================
  # 개발 환경용 JPA/Hibernate 설정
  # - Flyway로 스키마 관리
  # - PostgreSQL 사용
  # - 상세 로깅 및 디버깅 활성화
  jpa:
    hibernate:
      ddl-auto: none # Flyway가 스키마를 관리하므로 none으로 설정
      naming: # 네이밍 전략 설정
        physical-strategy: org.hibernate.boot.model.naming.CamelCaseToUnderscoresNamingStrategy # 카멜케이스 -> 스네이크케이스
        implicit-strategy: org.springframework.boot.orm.jpa.hibernate.SpringImplicitNamingStrategy # 암시적 네이밍 전략
    show-sql: ${SHOW_SQL:false} # SQL 쿼리 로깅 (개발 시 true 권장)
    open-in-view: ${JPA_OPEN_IN_VIEW:false} # OSIV 비활성화 - 트랜잭션 경계 명확화
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect # PostgreSQL 데이터베이스 방언
        format_sql: ${FORMAT_SQL:true} # SQL 포맷팅 (가독성 향상)
        generate_statistics: ${HIBERNATE_STATISTICS:true} # Hibernate 통계 수집
        enable_lazy_load_no_trans: false # LazyInitializationException 엄격 모드
        jdbc:
          batch_size: ${JDBC_BATCH_SIZE:25} # JDBC 배치 크기
          order_inserts: ${JDBC_ORDER_INSERTS:true} # INSERT 문 순서 최적화
          order_updates: ${JDBC_ORDER_UPDATES:true} # UPDATE 문 순서 최적화
          batch_versioned_data: ${JDBC_BATCH_VERSIONED_DATA:true} # 버전이 있는 데이터 배치 처리
        query:
          in_clause_parameter_padding: ${QUERY_IN_CLAUSE_PADDING:true} # IN 절 파라미터 패딩
          fail_on_pagination_over_collection_fetch: true # 컬렉션 페치 시 페이징 경고
        connection:
          provider_disables_autocommit: ${HIBERNATE_AUTOCOMMIT:false} # 자동 커밋 비활성화

  # ================================
  # Cache Configuration (Development)
  # ================================
  # 개발 환경용 캐시 설정
  # - Redis 캐시 사용
  # - 통계 수집 및 디버깅 활성화
  # - 짧은 TTL로 빠른 데이터 갱신
  cache:
    type: ${CACHE_TYPE:redis} # 캐시 타입
    redis: # Redis 캐시 설정
      time-to-live: ${CACHE_TTL:3600000} # 캐시 TTL (1시간 - 개발용 짧은 시간)
      key-prefix: "${spring.application.name}-dev:cache:" # 개발 환경용 키 접두사
      use-key-prefix: true # 키 접두사 사용
      cache-null-values: ${CACHE_NULL_VALUES:false} # null 값 캐싱 여부
      enable-statistics: ${CACHE_STATISTICS:true} # 캐시 통계 수집 (개발용 활성화)
      enable-time-to-idle: ${CACHE_TIME_TO_IDLE:true} # 유휴 시간 기반 만료

  # ================================
  # Flyway Configuration (Development)
  # ================================
  flyway:
    enabled: ${FLYWAY_ENABLED:true} # 개발 환경에서도 Flyway 활성화
    locations: classpath:db/migration
    baseline-on-migrate: true
    validate-on-migrate: false # 개발에서는 검증 느슨하게
    out-of-order: true
    clean-disabled: false # 개발에서는 clean 허용

  # ================================
  # Mail Configuration (Development)
  # ================================
  mail:
    host: ${MAIL_HOST:mailhog} # Gmail 사용 시: smtp.gmail.com
    port: ${MAIL_PORT:1025} # Gmail 사용 시: 587
    username: ${MAIL_USERNAME:}
    password: ${MAIL_PASSWORD:}
    protocol: smtp
    properties:
      mail:
        smtp:
          auth: ${MAIL_AUTH:false} # Gmail 사용 시: true
          starttls:
            enable: ${MAIL_STARTTLS:false} # Gmail 사용 시: true
            required: ${MAIL_STARTTLS:false} # Gmail 사용 시: true
          connectiontimeout: 5000
          timeout: 3000
          writetimeout: 5000
        debug: ${MAIL_DEBUG:true}

  # ================================
  # Security Configuration (Development)
  # ================================
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID:your-google-client-id}
            client-secret: ${GOOGLE_CLIENT_SECRET:your-google-client-secret}
            redirect-uri: ${GOOGLE_REDIRECT_URI:http://localhost:8080/login/oauth2/code/google}
            scope:
              - openid
              - email
              - profile
          github:
            client-id: ${GITHUB_CLIENT_ID:your-github-client-id}
            client-secret: ${GITHUB_CLIENT_SECRET:your-github-client-secret}
            redirect-uri: ${GITHUB_REDIRECT_URI:http://localhost:8080/login/oauth2/code/github}
            scope:
              - user:email
              - read:user
          kakao:
            client-id: ${KAKAO_CLIENT_ID:189bc1701403914a5e701d1325db0da5}
            client-secret: ${KAKAO_CLIENT_SECRET:l0rNzBb32vgWVgxz7j74WiRDuIyYqkrb}
            redirect-uri: ${KAKAO_REDIRECT_URI:http://localhost:8080/login/oauth2/code/kakao}
            authorization-grant-type: authorization_code
            client-authentication-method: client_secret_post
            scope:
              - account_email
              - profile_nickname
            provider: kakao
          naver:
            client-id: ${NAVER_CLIENT_ID:NvwJHLtK_ttnE3wDTFZj}
            client-secret: ${NAVER_CLIENT_SECRET:S_QEyzOOGg}
            redirect-uri: http://localhost:8080/login/oauth2/code/naver
            authorization-grant-type: authorization_code
            client-authentication-method: client_secret_post
            scope:
              - name
              - email
              - profile_image
            provider: naver
        provider:
          kakao:
            authorization-uri: https://kauth.kakao.com/oauth/authorize
            token-uri: https://kauth.kakao.com/oauth/token
            user-info-uri: https://kapi.kakao.com/v2/user/me
            user-name-attribute: id
          naver:
            authorization-uri: https://nid.naver.com/oauth2.0/authorize
            token-uri: https://nid.naver.com/oauth2.0/token
            user-info-uri: https://openapi.naver.com/v1/nid/me
            user-name-attribute: response
# ================================
# JWT Configuration (Development)
# ================================
jwt:
  secret: ${JWT_SECRET:campstation-dev-secret-key-this-is-only-for-development-environment-please-change-in-production-must-be-at-least-64-bytes-long-hs512}
  expiration: ${JWT_EXPIRATION:3600000} # 1시간 (개발용 연장)
  refresh-expiration: ${JWT_REFRESH_EXPIRATION:604800000} # 7일

# ================================
# Frontend URL (Development)
# ================================
frontend:
  url: ${FRONTEND_URL:http://localhost:3000}

# ================================
# CORS Configuration (Development)
# ================================
cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:8080,http://frontend:3000}
  allowed-methods: GET,POST,PUT,DELETE,OPTIONS,PATCH
  allowed-headers: "*"
  allow-credentials: true
  max-age: 3600

# ================================
# File Upload Configuration (Development)
# ================================
file:
  upload:
    path: ${FILE_UPLOAD_PATH:s3://campstation-dev/}
    max-size: ${FILE_MAX_SIZE_BYTES:104857600} # 100MB (개발용 확대)
    max-request-size: ${FILE_MAX_REQUEST_SIZE:104857600}

# ================================
# AWS S3 Configuration (Development)
# ================================
cloud:
  aws:
    s3:
      bucket: ${AWS_S3_BUCKET_NAME:campstation-dev}
      endpoint: ${AWS_S3_ENDPOINT:http://minio:9000}
      region: ${AWS_REGION:us-east-1}
      path-style-access-enabled: ${AWS_S3_PATH_STYLE:true}
    stack:
      auto: false
    credentials:
      access-key: ${AWS_ACCESS_KEY_ID:campstation}
      secret-key: ${AWS_SECRET_ACCESS_KEY:campstation123}
    region:
      static: ${AWS_REGION:us-east-1}

# ================================
# Logging Configuration (Development)
# ================================
logging:
  level:
    root: ${LOG_LEVEL:ERROR}
    com.campstation: ${APP_LOG_LEVEL:INFO}
    org.springframework: ${SPRING_LOG_LEVEL:WARN}
    org.springframework.security: ${SECURITY_LOG_LEVEL:WARN}
    org.springframework.security.web: ${SECURITY_WEB_LOG_LEVEL:WARN}
    org.springframework.security.oauth2: DEBUG
    com.campstation.camp.security: DEBUG
    org.springframework.web: ${WEB_LOG_LEVEL:WARN}
    org.springframework.web.servlet: ${WEB_SERVLET_LOG_LEVEL:WARN}
    org.springframework.data: ${DATA_LOG_LEVEL:WARN}
    org.springframework.boot: ${BOOT_LOG_LEVEL:WARN}
    org.springframework.boot.autoconfigure: ${AUTO_CONFIG_LOG_LEVEL:WARN}
    org.hibernate: ${HIBERNATE_LOG_LEVEL:WARN}
    org.hibernate.SQL: ${SQL_LOG_LEVEL:WARN}
    org.hibernate.type.descriptor.sql.BasicBinder: ${SQL_BINDING_LOG_LEVEL:WARN}
    org.postgresql: ${POSTGRES_LOG_LEVEL:WARN}
    org.flywaydb: ${FLYWAY_LOG_LEVEL:WARN}
    com.zaxxer.hikari: ${HIKARI_LOG_LEVEL:WARN}
    io.lettuce: ${LETTUCE_LOG_LEVEL:WARN}
    io.netty: ${NETTY_LOG_LEVEL:WARN}
    software.amazon.awssdk: ${AWS_LOG_LEVEL:WARN}
    org.apache.catalina: ${TOMCAT_LOG_LEVEL:WARN}
    org.apache.tomcat: ${TOMCAT_LOG_LEVEL:WARN}
    org.apache.coyote: ${TOMCAT_LOG_LEVEL:WARN}
    angus: ${ANGUS_LOG_LEVEL:WARN}
    jakarta: ${JAKARTA_LOG_LEVEL:WARN}
    org.eclipse.angus: ${ANGUS_LOG_LEVEL:WARN}
    java.mail: ${MAIL_LOG_LEVEL:WARN}
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: ${LOG_FILE:/app/logs/campstation-dev.log}
  logback:
    rollingpolicy:
      max-file-size: ${LOG_MAX_FILE_SIZE:10MB}
      max-history: ${LOG_MAX_HISTORY:7}
      total-size-cap: ${LOG_TOTAL_SIZE_CAP:100MB}
      file-name-pattern: ${LOG_FILE_PATTERN:%d{yyyy-MM-dd}.%i.gz}

# ================================
# Management Configuration (Development)
# ================================
management:
  server:
    # port: ${MANAGEMENT_PORT:8081}  # 메인 포트와 동일하게 사용
    # address: ${MANAGEMENT_ADDRESS:0.0.0.0}  # 별도 포트가 아니므로 address도 설정 불가
  endpoints:
    web:
      exposure:
        include: ${MANAGEMENT_ENDPOINTS_INCLUDE:health,info,metrics,prometheus,env,configprops,loggers,threaddump,heapdump,flyway}
      base-path: /actuator
      cors:
        allowed-origins: ${MANAGEMENT_CORS_ORIGINS:http://localhost:3000,http://localhost:8080,http://frontend:3000}
        allowed-methods: GET,POST,OPTIONS
  endpoint:
    health:
      enabled: ${MANAGEMENT_HEALTH_ENABLED:true}
      show-details: ${MANAGEMENT_HEALTH_SHOW_DETAILS:always} # 개발에서는 항상 상세 정보 표시
      probes:
        enabled: ${MANAGEMENT_HEALTH_PROBES_ENABLED:true}
      redis:
        enabled: true
    metrics:
      enabled: ${MANAGEMENT_METRICS_ENABLED:true}
    prometheus:
      enabled: ${MANAGEMENT_PROMETHEUS_ENABLED:true}
    info:
      enabled: ${MANAGEMENT_INFO_ENABLED:true}
      env:
        enabled: ${MANAGEMENT_INFO_ENV_ENABLED:true}
      java:
        enabled: ${MANAGEMENT_INFO_JAVA_ENABLED:true}
      os:
        enabled: ${MANAGEMENT_INFO_OS_ENABLED:true}
  metrics:
    export:
      prometheus:
        enabled: ${MANAGEMENT_PROMETHEUS_ENABLED:true}
        descriptions: true
        histogram-flavor: prometheus
    tags:
      application: ${spring.application.name}
      environment: development
      profile: dev
    distribution:
      percentiles-histogram:
        http.server.requests: true
        http.server.duration: true
        redis.commands: true
      percentiles:
        http.server.requests: 0.5,0.9,0.95,0.99
        http.server.duration: 0.5,0.9,0.95,0.99
        redis.commands: 0.5,0.9,0.95,0.99
      slo:
        http.server.requests: 50ms,100ms,200ms,500ms
        http.server.duration: 50ms,100ms,200ms,500ms

# ================================
# Server Configuration (Development)
# ================================
server:
  port: ${SERVER_PORT:8080}
  address: ${SERVER_ADDRESS:0.0.0.0}
  servlet:
    context-path: ${SERVER_CONTEXT_PATH:/}
    session:
      timeout: ${SERVER_SESSION_TIMEOUT:60m} # 개발용 연장
      cookie:
        http-only: true
        secure: ${SERVER_SESSION_COOKIE_SECURE:false}
        same-site: ${SERVER_SESSION_COOKIE_SAMESITE:Lax}
  compression:
    enabled: ${SERVER_COMPRESSION_ENABLED:true}
    mime-types: ${SERVER_COMPRESSION_MIME_TYPES:text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json,application/xml,application/xml+rss}
    min-response-size: ${SERVER_COMPRESSION_MIN_RESPONSE_SIZE:1024}
  error:
    include-message: ${SERVER_ERROR_INCLUDE_MESSAGE:always} # 개발에서는 에러 메시지 표시
    include-binding-errors: ${SERVER_ERROR_INCLUDE_BINDING_ERRORS:always}
    include-stacktrace: ${SERVER_ERROR_INCLUDE_STACKTRACE:on_param}
    include-exception: ${SERVER_ERROR_INCLUDE_EXCEPTION:true}
  shutdown: ${SERVER_SHUTDOWN:graceful}
  tomcat:
    threads:
      max: ${TOMCAT_THREADS_MAX:100} # 개발용 축소
      min-spare: ${TOMCAT_THREADS_MIN_SPARE:5}
    connection-timeout: ${TOMCAT_CONNECTION_TIMEOUT:20000}
    keep-alive-timeout: ${TOMCAT_KEEP_ALIVE_TIMEOUT:20000}
    max-http-header-size: ${TOMCAT_MAX_HTTP_HEADER_SIZE:8192}
    max-swallow-size: ${TOMCAT_MAX_SWALLOW_SIZE:2MB}
    accept-count: ${TOMCAT_ACCEPT_COUNT:50}
    processor-cache: ${TOMCAT_PROCESSOR_CACHE:100}

  # ================================
  # H2 Database Console (Development Only)
  # ================================
  h2:
    console:
      enabled: true
      path: /h2-console
      settings:
        web-allow-others: true
        trace: false

# ================================
# Development Specific Properties
# ================================
app:
  name: ${spring.application.name}
  version: ${APP_VERSION:1.0.0-SNAPSHOT}
  description: CampStation Backend (Development)
  environment: development
  debug:
    enabled: ${DEBUG_ENABLED:true}
    show-sql: ${DEBUG_SHOW_SQL:true}
    show-bindings: ${DEBUG_SHOW_BINDINGS:true}
  security:
    jwt:
      secret: ${JWT_SECRET:campstation-dev-secret-key-this-is-only-for-development-environment-please-change-in-production-must-be-at-least-64-bytes-long-hs512}
      expiration: ${JWT_EXPIRATION:3600000}
      refresh-expiration: ${JWT_REFRESH_EXPIRATION:604800000}
    cors:
      allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:8080,http://frontend:3000}
  cache:
    redis:
      enabled: ${CACHE_REDIS_ENABLED:true}
      ttl: ${CACHE_TTL:3600000}
  database:
    init:
      enabled: ${DB_INIT_ENABLED:true}
      schema: ${DB_INIT_SCHEMA:classpath:schema-dev.sql}
      data: ${DB_INIT_DATA:classpath:data-dev.sql}
  file:
    upload:
      max-size: ${FILE_MAX_SIZE_BYTES:104857600}
      allowed-extensions: ${FILE_ALLOWED_EXTENSIONS:jpg,jpeg,png,gif,pdf,doc,docx,txt,zip}
  mail:
    enabled: ${MAIL_ENABLED:true}
    from: ${MAIL_FROM:dev@campstation.com}
  external:
    apis:
      weather:
        url: ${WEATHER_API_URL:http://api.openweathermap.org/data/2.5}
        key: ${WEATHER_API_KEY:dev-weather-api-key}
      map:
        kakao:
          key: ${KAKAO_MAP_API_KEY:dev-kakao-map-key}
  monitoring:
    enabled: ${MONITORING_ENABLED:true}
    metrics:
      enabled: ${METRICS_ENABLED:true}
    tracing:
      enabled: ${TRACING_ENABLED:false}
  features:
    swagger:
      enabled: ${SWAGGER_ENABLED:true}
      path: ${SWAGGER_PATH:/swagger-ui.html}
    actuator:
      enabled: ${ACTUATOR_ENABLED:true}
      sensitive: ${ACTUATOR_SENSITIVE:false}
    show-sql: ${SHOW_SQL:false}
    open-in-view: true
    properties:
      hibernate:
        format_sql: ${FORMAT_SQL:true}
        generate_statistics: false
        jdbc:
          batch_size: 5

  # ================================
  # H2 Console (Development Only)
  # ================================
  h2:
    console:
      enabled: true
      path: /h2-console
      settings:
        web-allow-others: true

# ================================
# Rate Limiting Configuration (Development)
# ================================
# 개발 환경: 넉넉한 제한으로 개발 편의성 향상
rate-limit:
  auth:
    capacity: ${RATE_LIMIT_AUTH_CAPACITY:1000} # 인증 API: 1000 req/min
    duration-minutes: ${RATE_LIMIT_AUTH_DURATION:1} # 1분당
  payment:
    capacity: ${RATE_LIMIT_PAYMENT_CAPACITY:500} # 결제 API: 500 req/min
    duration-minutes: ${RATE_LIMIT_PAYMENT_DURATION:1} # 1분당
  api:
    capacity: ${RATE_LIMIT_API_CAPACITY:5000} # 일반 API: 5000 req/min
    duration-minutes: ${RATE_LIMIT_API_DURATION:1} # 1분당

# ================================
# Security Configuration (Development)
# ================================
security:
  user:
    name: ${ADMIN_USERNAME:admin}
    password: ${ADMIN_PASSWORD:campstation2024}
